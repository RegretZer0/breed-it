<%- include("../../../partials/farm-manager/header") %>
<%- include("../../../partials/farm-manager/navbar") %>
<%- include("../../../partials/farm-manager/sidepanel") %>

<main class="main-content">
  <div class="container-fluid">

    <%- include("../../../partials/farm-manager/farmer_panel") %>

    <!-- ================= MAIN HEADER ================= -->
    <div class="outer-card">
      <div class="header-row">
        <h1>MANAGE ACCOUNT</h1>
      </div>

      <div class="inner-card">

        <!-- ===== FARMER STATS ===== -->
        <div class="stats-row mb-3">
          <div class="stat">
            <div class="stat-left">
              <div class="stat-label">Total Farmers</div>
              <div class="stat-value" id="totalFarmers">0</div>
            </div>
            <div class="stat-icon amber">
              <i class="fa-solid fa-user"></i>
            </div>
          </div>

          <div class="stat">
            <div class="stat-left">
              <div class="stat-label">Active</div>
              <div class="stat-value" id="activeFarmers">0</div>
            </div>
            <div class="stat-icon green">
              <i class="fa-solid fa-user-check"></i>
            </div>
          </div>

          <div class="stat">
            <div class="stat-left">
              <div class="stat-label">Inactive</div>
              <div class="stat-value" id="inactiveFarmers">0</div>
            </div>
            <div class="stat-icon red">
              <i class="fa-solid fa-user-xmark"></i>
            </div>
          </div>
        </div>

        <!-- ===== ENCODER STATS ===== -->
        <div class="stats-row mb-3">
          <div class="stat">
            <div class="stat-left">
              <div class="stat-label">Total Encoders</div>
              <div class="stat-value" id="totalEncoders">0</div>
            </div>
            <div class="stat-icon blue">
              <i class="fa-solid fa-user-pen"></i>
            </div>
          </div>

          <div class="stat">
            <div class="stat-left">
              <div class="stat-label">Active Encoders</div>
              <div class="stat-value" id="activeEncoders">0</div>
            </div>
            <div class="stat-icon green">
              <i class="fa-solid fa-user-check"></i>
            </div>
          </div>

          <div class="stat">
            <div class="stat-left">
              <div class="stat-label">Inactive Encoders</div>
              <div class="stat-value" id="inactiveEncoders">0</div>
            </div>
            <div class="stat-icon red">
              <i class="fa-solid fa-user-xmark"></i>
            </div>
          </div>
        </div>

        <!-- ===== FILTER CONTROLS ===== -->
        <div class="card page-card mb-3">
          <div class="card-body">
            <form id="accountFiltersForm" class="row g-2 align-items-end">

              <!-- ACCOUNT SEARCH FILTER -->
              <div class="col-md-4 position-relative">
                <label class="form-label small">Account</label>

                <div class="dropdown w-100">
                  <button
                    class="form-select form-select-sm text-start"
                    type="button"
                    id="filterFarmerBtn"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    Select Account
                  </button>

                  <div
                    class="dropdown-menu w-100 p-2"
                    style="max-height:260px; overflow-y:auto;"
                  >
                    <input
                      type="text"
                      id="filterFarmerSearch"
                      class="form-control form-control-sm mb-2"
                      placeholder="Search account..."
                    />

                    <div id="filterFarmerOptions">
                      <div class="text-muted small">Loading accounts...</div>
                    </div>
                  </div>
                </div>

                <!-- hidden selected account -->
                <input type="hidden" id="filterFarmerId">
              </div>

              <!-- LOCATION -->
              <div class="col-md-4">
                <label class="form-label small">Location / Address</label>
                <input
                  id="filterLocation"
                  class="form-control form-control-sm"
                  placeholder="Enter address"
                />
              </div>

              <!-- ACCOUNT TYPE -->
              <div class="col-md-3">
                <label class="form-label small">Account Type</label>
                <select id="filterAccountType" class="form-select form-select-sm">
                  <option value="" disabled selected>Select type</option>
                  <option value="all">All</option>
                  <option value="farmer">Farmer</option>
                  <option value="encoder">Encoder</option>
                </select>
              </div>

              <!-- STATUS -->
              <div class="col-md-3">
                <label class="form-label small">Account Status</label>
                <select id="filterStatus" class="form-select form-select-sm">
                  <option value="" disabled selected>Select status</option>
                  <option value="all">All</option>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>

              <!-- ACTIONS -->
              <div class="col-md-2 d-grid">
                <button type="submit" class="btn btn-sm btn-success">Apply</button>
              </div>

              <div class="col-md-2 d-grid">
                <button
                  type="button"
                  id="resetFiltersBtn"
                  class="btn btn-sm btn-outline-secondary"
                >
                  Reset
                </button>
              </div>

            </form>
          </div>
        </div>


        <!-- ===== FILTERED RESULTS ===== -->
        <div id="filteredSection" class="table-wrap mt-3 d-none">
          <table class="table table-sm mb-0">
            <thead>
              <tr>
                <th>ID</th>
                <th>NAME</th>
                <th>ADDRESS</th>
                <th>CONTACT</th>
                <th>PENS</th>
                <th>CAPACITY</th>
                <th>STATUS</th>
                <th>ACTION</th>
              </tr>
            </thead>
            <tbody id="filteredTbody"></tbody>
          </table>
        </div>

      </div>
    </div>

    <!-- ================= RECENTLY ADDED ================= -->
    <div class="outer-card mt-4">
      <div class="header-row">
        <h2>Recently Added</h2>
      </div>

      <div class="inner-card">
        <div class="table-wrap">
          <table class="table table-sm mb-0">
            <thead>
              <tr>
                <th>ID</th>
                <th>NAME</th>
                <th>ROLE</th>
                <th>ADDRESS</th>
                <th>STATUS</th>
              </tr>
            </thead>
            <tbody id="recentTbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ================= ACCOUNT LIST ================= -->
    <div class="outer-card mt-4">
      <div class="header-row">
        <h2>Account List</h2>
      </div>

      <div class="inner-card">
        <div class="table-wrap">
          <table class="table table-sm mb-0">
            <thead>
              <tr>
                <th>ID</th>
                <th>NAME</th>
                <th>ROLE</th>
                <th>ADDRESS</th>
                <th>CONTACT</th>
                <th>PENS</th>
                <th>CAPACITY</th>
                <th>STATUS</th>
                <th>ACTION</th>

              </tr>
            </thead>
            <tbody id="farmersTbody"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</main>

<!-- ================= EDIT MODAL ================= -->
<div id="editModal" class="edit-modal d-none">
  <form id="editFarmerForm" class="edit-form">

    <!-- Close X -->
    <button type="button" id="closeModalX" class="modal-close-btn">&times;</button>

    <h5>Edit Account</h5>

    <p class="small text-muted mb-2">
      Account Type: <strong id="editRoleLabel"></strong>
    </p>

    <div class="row g-2">
      <div class="col">
        <label class="form-label small">First Name</label>
        <input id="editFirstName" class="form-control form-control-sm" required />
      </div>
      <div class="col">
        <label class="form-label small">Last Name</label>
        <input id="editLastName" class="form-control form-control-sm" required />
      </div>
    </div>

    <label class="form-label small mt-2">Address</label>
    <input id="editAddress" class="form-control form-control-sm" required/>

    <label class="form-label small mt-2">Contact Number</label>
    <input
      id="editContact"
      class="form-control form-control-sm"
      type="tel"
      required
      pattern="^(09\d{9}|\+639\d{9})$"
      placeholder="09XXXXXXXXX or +639XXXXXXXXX"
      title="Enter a valid Philippine phone number (09XXXXXXXXX or +639XXXXXXXXX)"
    />


    <label class="form-label small mt-2">Account Status</label>
    <select id="editStatus" class="form-select form-select-sm" required>
      <option value="active">Active</option>
      <option value="inactive">Inactive</option>
    </select>

    <div id="farmerOnlyFields" class="mt-2">
      <label class="form-label small">Number of Pens</label>
      <input id="editPens" type="number" class="form-control form-control-sm mb-2" required />

      <label class="form-label small">Pen Capacity</label>
      <input id="editCapacity" type="number" class="form-control form-control-sm" />
    </div>

    <div class="d-flex justify-content-end gap-2 mt-3">
      <button type="button" id="closeModal" class="btn btn-sm btn-secondary">
        Cancel
      </button>
      <button type="submit" class="btn btn-sm btn-primary">
        Update
      </button>
    </div>

  </form>
</div>

<%- include("../../../partials/farm-manager/footer") %>
