<%- include("../../partials/farm-manager/header") %>
<%- include("../../partials/farm-manager/navbar") %>
<%- include("../../partials/farm-manager/sidepanel") %>

<!-- Main content -->
<main class="main-content">
  <div class="container-fluid">
    <!-- <div class="card page-card"> -->
        <div class="card page-card overview-card">
          <div class="card-body">
              <h4 class="page-title">FARMER REPORTS</h4>


            <!-- STATS GRID -->
            <div class="row g-3 stats-grid">
              <div class="col-md-6 col-lg-3">
                <div class="stat-card d-flex justify-content-between align-items-center">
                  <div>
                    <div class="stat-label">In-Heat</div>
                    <div class="stat-number" id="countInHeat">0</div>
                  </div>
                  <div class="stat-icon orange">
                    <i class="fa-solid fa-fire"></i>
                  </div>
                </div>
              </div>

              <div class="col-md-6 col-lg-3">
                <div class="stat-card d-flex justify-content-between align-items-center">
                  <div>
                    <div class="stat-label">Under Observation</div>
                    <div class="stat-number" id="countAwaitingRecheck">0</div>
                  </div>
                  <div class="stat-icon blue">
                    <i class="fa-solid fa-clock-rotate-left"></i>
                  </div>
                </div>
              </div>

              <div class="col-md-6 col-lg-3">
                <div class="stat-card d-flex justify-content-between align-items-center">
                  <div>
                    <div class="stat-label">Pregnant</div>
                    <div class="stat-number" id="countPregnant">0</div>
                  </div>
                  <div class="stat-icon green">
                    <i class="fa-solid fa-piggy-bank"></i>
                  </div>
                </div>
              </div>

              <div class="col-md-6 col-lg-3">
                <div class="stat-card d-flex justify-content-between align-items-center">
                  <div>
                    <div class="stat-label">Farrowing Soon</div>
                    <div class="stat-number" id="countFarrowingReady">0</div>
                  </div>
                  <div class="stat-icon red">
                    <i class="fa-solid fa-warehouse"></i>
                  </div>
                </div>
              </div>
            </div>

            <!-- DIVIDER -->
            <hr style="margin: 24px 0;">

            <!-- FILTER SECTION -->
            <h5 class="card-title">Filter Reports</h5>

            <div class="filter-row">
              <input type="text" id="filterSwine" placeholder="Swine ID">

              <select id="filterStatus">
                <option value="">All Status</option>
                <option value="pending">Pending</option>
                <option value="approved">Approved</option>
                <option value="waiting_heat_check">Under Observation</option>
                <option value="pregnant">Pregnant</option>
              </select>

              <button id="applyFilter">Apply</button>
              <button id="clearFilter" class="secondary">Clear</button>
            </div>

            <!-- FILTERED RESULTS (INSIDE SAME CARD) -->
            <div
              id="filteredResultsCard"
              style="display:none; margin-top: 24px;"
            >
              <hr style="margin: 24px 0;">

              <h5 class="card-title">Filtered Results</h5>

              <div class="table-responsive">
                <table class="reports-table">
                  <thead>
                    <tr>
                      <th>Swine ID</th>
                      <th>Farmer</th>
                      <th>Date</th>
                      <th>Status</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody id="filteredTableBody"></tbody>
                </table>
              </div>

              <!-- ‚úÖ FILTERED PAGINATION -->
              <div
                class="filtered-pagination"
                style="margin-top:12px; display:flex; gap:12px; align-items:center;"
              >
                <button id="filteredPrevBtn" class="btn btn-sm" disabled>
                  Prev
                </button>

                <span
                  id="filteredPageIndicator"
                  style="font-size:13px; font-weight:600;"
                ></span>

                <button id="filteredNextBtn" class="btn btn-sm" disabled>
                  Next
                </button>
              </div>
            </div>

          </div>
        </div>


    <!-- REPORTS TABLE CARD -->
    <div class="card page-card reports-card" style="margin-top: 20px;">
      <div class="card-body">

        <div class="card-header-row">
          <h5 class="card-title">Heat Reports</h5>
        </div>

        <div class="table-responsive">
          <table class="reports-table">
            <thead>
              <tr>
                <th>Swine ID</th>
                <th>Farmer</th>
                <th>Date Reported</th>
                <th>Probability</th>
                <th>Status</th>
                <th>Next Heat</th>
                <th>Expected Farrowing</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="reportsTableBody">
              <tr>
                <td colspan="8">Loading reports...</td>
              </tr>
            </tbody>
          </table>
        </div>

              <!-- üîΩ PAGINATION CONTROLS (STEP 2) -->
              <div
                class="d-flex justify-content-between align-items-center mt-3"
                style="gap: 12px;"
              >
                <button
                  id="prevPageBtn"
                  class="btn-nav secondary"
                  type="button"
                >
                  ‚Üê Prev
                </button>

                <span
                  id="pageIndicator"
                  style="font-weight:600; font-size:14px;"
                >
                  Page 1 of 1
                </span>

                <button
                  id="nextPageBtn"
                  class="btn-nav secondary"
                  type="button"
                >
                  Next ‚Üí
                </button>
              </div>

            </div>
          </div>

    </main>

  <!-- REPORT DETAILS MODAL -->
  <div id="reportDetailsModal" class="modal-overlay">
    <div class="modal-panel">

      <div class="modal-header">
        <h5>Report Details</h5>
        <button class="modal-close" id="closeReportModal">&times;</button>
      </div>

      <div class="modal-body">
        <!-- DETAILS GRID -->
        <div class="detail-grid">
          <div class="report-summary">
            <div class="report-row">
              <p id="reportSwine"></p>
              <span id="reportStatus" class="report-status"></span>
            </div>

            <p id="reportFarmer"></p>
            <p id="reportProbability"></p>

            <div class="report-signs">
              <h6>Observed Signs</h6>
              <div id="reportSigns" class="signs-container"></div>
            </div>
          </div>

        </div>

        <!-- MEDIA GALLERY -->
        <div class="media-wrapper">
          <div id="evidenceGallery" class="evidence-gallery"></div>
        </div>



      <div class="modal-footer report-actions">
        <button id="approveBtn" style="display:none;">Approve</button>
        <button id="rejectBtn" style="display:none;">Reject</button>

        <button id="confirmAIBtn" style="display:none;">üíâ Confirm AI</button>
        <button id="confirmPregnancyBtn" style="display:none;">ü§∞ Confirm Pregnancy</button>

        <!-- NEW -->
        <button id="followUpBtn" style="display:none;">üîÑ Cycle Failed</button>
        <button id="confirmFarrowingBtn" style="display:none;">üê∑ Confirm Farrowing</button>

        <button class="secondary" id="closeReportModalBtn">Close</button>
      </div>

    </div>
  </div>


 <!-- AI CONFIRMATION MODAL (REQUIRED FOR CONFIRM AI FLOW) -->
        <div id="aiConfirmModal" class="modal">
          <div class="modal-content">
            <h3>üíâ Confirm AI Service</h3>

            <label for="boarSelect">Select Sire (Boar)</label>
            <select id="boarSelect"></select>

            <div style="display: flex; gap: 10px; margin-top: 15px;">
              <button
                id="submitAI"
                class="btn-nav"
                style="flex: 1; background: var(--stat-blue); color: #fff;">
                Confirm AI
              </button>

              <button
                type="button"
                class="btn-nav secondary"
                style="flex: 1;"
                onclick="document.getElementById('aiConfirmModal').style.display='none'">
                Cancel
              </button>
            </div>
          </div>
        </div>

        <!-- FARROWING CONFIRMATION MODAL -->
        <div id="farrowingModal" class="modal">
          <div class="modal-content" style="width: 450px;">
            <h3 style="margin-top:0;">üê∑ Register Farrowing Results</h3>

            <form id="farrowingForm">
              <label>Actual Farrowing Date</label>
              <input type="date" id="farrowingDateInput" required>

              <div class="count-grid">
                <div>
                  <label>Live</label>
                  <input type="number" id="liveCount" min="0" value="0" required>
                </div>

                <div>
                  <label>Mummy</label>
                  <input type="number" id="mummyCount" min="0" value="0">
                </div>

                <div>
                  <label>Stillborn</label>
                  <input type="number" id="stillCount" min="0" value="0">
                </div>
              </div>

              <div style="display:flex; gap:10px; margin-top:15px;">
                <button type="submit" class="btn-nav" style="flex:1;">
                  Confirm Farrowing
                </button>
                <button
                  type="button"
                  class="btn-nav secondary"
                  style="flex:1;"
                  onclick="document.getElementById('farrowingModal').style.display='none'">
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- REJECT REPORT MODAL -->
        <div id="rejectReasonModal" class="modal">
          <div class="modal-content" style="max-width: 420px;">
            <h3>Reject Report</h3>

            <p class="text-muted" style="margin-bottom:10px;">
              Please provide a reason for rejecting this report.
            </p>

            <textarea
              id="rejectReasonInput"
              rows="4"
              placeholder="Enter rejection reason..."
              style="resize:none;"
            ></textarea>

            <div style="display:flex; gap:10px; margin-top:14px;">
              <button id="confirmRejectBtn" class="btn-nav" style="flex:1; background: var(--stat-red); color:#fff;">
                Reject Report
              </button>

              <button
                type="button"
                class="btn-nav secondary"
                style="flex:1;"
                onclick="document.getElementById('rejectReasonModal').style.display='none'">
                Cancel
              </button>
            </div>
          </div>
        </div>



<%- include("../../partials/farm-manager/footer") %>