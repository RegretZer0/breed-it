<%- include("../../partials/farmer/farmer_nav") %>

<div class="app-root">
  <main class="report-container">
    <h2 class="page-title">REPORT</h2>

    <!-- TABS -->
    <div class="report-tabs">
      <button class="tab active" id="logsTab">LOGS</button>
      <button class="tab outline" id="createTab">CREATE REPORT</button>
    </div>

    <!-- ================= LOGS ================= -->
    <section id="logsSection">
      <div class="filters">
        <div class="filter">
          <label>Status</label>
          <select id="statusFilter">
            <option value="">All</option>
            <option value="pending">Pending</option>
            <option value="accepted">Accepted</option>
            <option value="waiting_heat_check">Waiting Heat Check</option>
            <option value="pregnant">Pregnant</option>
            <option value="rejected">Rejected</option>
          </select>
        </div>

        <div class="filter">
          <label>Date</label>
          <input type="date" id="dateFilter" />
        </div>

        <div class="filter">
          <label>Pig Tag</label>
          <select id="pigFilter">
            <option value="">All pigs</option>
          </select>
        </div>

        <button class="search-btn" id="searchBtn">
          <i class="fa-solid fa-magnifying-glass"></i> SEARCH
        </button>
        <button class="search-btn outline" id="clearFilterBtn">CLEAR</button>
      </div>

      <!-- ================= STATS (REQUIRED BY JS) ================= -->
      <div class="stats-container">
        <div class="stat-card">
          <div>
            <h4>Open Sows</h4>
            <span id="countOpen">0</span>
          </div>
          <div class="stat-icon blue">
            <i class="fa-solid fa-o"></i>
          </div>
        </div>

        <div class="stat-card">
          <div>
            <h4>Pregnant</h4>
            <span id="countPregnant">0</span>
          </div>
          <div class="stat-icon pink">
            <i class="fa-solid fa-piggy-bank"></i>
          </div>
        </div>

        <div class="stat-card">
          <div>
            <h4>Farrowing Soon</h4>
            <span id="countFarrowing">0</span>
          </div>
          <div class="stat-icon orange">
            <i class="fa-solid fa-clock"></i>
          </div>
        </div>
      </div>


      <!-- RECENT LOGS -->
      <h4 class="section-title">Recent Logs</h4>

      <!-- ================= TABLE LOGS (REQUIRED BY JS) ================= -->
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Swine ID</th>
              <th>Report Date</th>
              <th>Status & Feedback</th>
              <th>Next Heat Check</th>
              <th>Expected Farrowing</th>
              <th>Required Action</th>
            </tr>
          </thead>
          <tbody id="reportsTableBody">
            <tr>
              <td colspan="6" style="text-align:center;">
                Checking for active reports...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ================= REPORT DETAILS MODAL ================= -->
    <div id="reportModal" class="modal hidden">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3>Report Details</h3>
        <div id="modalBody">
          <p>Loading...</p>
        </div>
      </div>
    </div>

    <!-- ================= CREATE REPORT ================= -->
    <section id="createSection" class="hidden">
      <form id="heatReportForm" class="form-card">

        <!-- GENERAL -->
        <div class="form-section">
          <h4>General Information</h4>

          <label>Select Pig</label>
          <select id="swineSelect" required>
            <option value="">Loading your swine...</option>
          </select>
        </div>

        <!-- HEAT SIGNS -->
        <div class="form-section">
          <h4>Observed Heat Signs</h4>

          <div class="checkbox-group">
            <label><input type="checkbox" name="signs" value="Reddened Vulva"> Reddened Vulva</label>
            <label><input type="checkbox" name="signs" value="Swollen Vulva"> Swollen Vulva</label>
            <label><input type="checkbox" name="signs" value="Mucous Discharge"> Mucous Discharge</label>
            <label><input type="checkbox" name="signs" value="Seeking the Boar"> Seeking the Boar</label>
            <label><input type="checkbox" name="signs" value="Perked/Twitching Ears"> Perked / Twitching Ears</label>
            <label><input type="checkbox" name="signs" value="Standing Reflex"><strong> Standing Reflex</strong></label>
            <label><input type="checkbox" name="signs" value="Back Pressure Test"><strong> Back Pressure Test</strong></label>
          </div>

          <small class="hint-text">Select all that apply</small>
        </div>

        <!-- UPLOAD EVIDENCE -->
        <div class="form-section">
          <h4>Upload Evidence</h4>

          <div class="upload-box">
            <input
              type="file"
              id="evidence"
              name="evidence"
              accept="image/*,video/*"
              multiple
              required
              hidden
            />

            <button type="button" class="upload-btn" id="uploadBtn">
              <i class="fa-solid fa-plus"></i>
            </button>

            <span id="fileCountBadge" class="file-counter-badge"></span>
            <div id="mediaPreview"></div>
          </div>

          <small class="hint-text">
            Upload clear photos or videos (maximum 5 files).
          </small>
        </div>

        <!-- ACTIONS -->
        <div class="form-actions">
          <button type="button" class="cancel-btn" id="cancelCreate">CANCEL</button>
          <!-- REQUIRED CLASS FOR JS -->
          <button type="submit" class="btn-submit send-btn">SEND</button>
        </div>

        <p id="reportMessage"></p>
      </form>
    </section>
  </main>
</div>

<%- include("../../partials/farmer/farmer_footer") %>
